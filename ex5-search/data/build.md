# Сборка GameFace

Схема сборки:

![Схема сборки](build-1.png)

## Характеристики

Время сборки:

| Подход | Время полного билда | Время пересборки по модификации (НГ) |
| ------ | ------------------- | ------------------------------------ |
| Старый | ~3:15               | не возможна                          |
| Новый  | ~8:05               | ~0:37                                |

Так как теперь для каждой фичи мы запускаем отдельную сборку общее время сборки выросло значительно. Вендоров мы собираем для каждой фичи отдельно что позволяет загружать только используемые библиотеки. Функционал пересборки по фичам позволяет пересобирать нужные исходники значительно быстрее.

Возможности сборки:

-   Пересборка по фичам - мы можем отслеживать изменившиеся фичи и пересобирать только их.
-   Полная пересборка - пересобираем все фичи. Автоматически включается при модификации вендоров или shared компонентов.
-   Режим работы с фичёй - сборщик смотрит только на изменение конкретной фичи и пересобирает её. (используем при разработке)

## Как с этим работать

### Client

Все команды запускаются под директорией "`...\game\res\wot\gui\gameface`"

Перед запуском команд необходимо установить модули командой `npm install`

| Команда                        | Описание                                                                                                                                                                                                | Куда собирает                              |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------ |
| `npm run build`                | Запускает полную пересборку всех фичей (кроме экстеншенов)(в `_dist`)                                                                                                                                   | `_dist`                                    |
| `npm run buildDev`             | Запускает полную пересборку всех фичей (кроме экстеншенов)(в `_dev`)                                                                                                                                    | `_dev`                                     |
| `npm run buildModified`        | Запускает пересборку только тех фичей, которые были изменены. Если была затронута shared функциональность, которая влияет на все фичи запускается пересборка всех фичей (кроме экстеншенов)(в `_dist`)  | `_dist`                                    |
| `npm start`                    | Запускает пересборку конкретной (выбор фичи осуществляется полсе запуска в консоли) фичи с вотчем (hotreload)                                                                                           | `_dev`                                     |
| `npm run build:extensions`     | Запускает сборку всех включенных экстеншенов.                                                                                                                                                           | `_dist` (директория экстеншена)            |
| `npm run buildDev:extensions`  | Запускает сборку всех включенных экстеншенов.                                                                                                                                                           | `_dev` (директория экстеншена)             |
| `npm start: extensions`        | Запускает сборку всех включенных экстеншенов с вотчем (hotreload).                                                                                                                                      |                                            |
| `npm run buildFromClient`      | Запускает пересборку всех фичей и всех включенных экстеншенов (Запускается автоматически при старте клиента если выставлен в преференсах)                                                               | `_dist` и `_dist` (директория экстеншенов) |
| `npm run buildFromClientWatch` | Запускает сборку с вотчем (hotreload) на выбранную фичу (выбор фичи предоставляется в диалоге(окно Node)) или на экстеншены(Запускаеться автоматически при старте клиента если выставлен в преференсах) | `_dev` и `_dev` (директория экстеншенов)   |

### TeamCity

Запуск ребилда модифицированных фичей (если затронуты shared запустится полный ребилд) (ребилд экстеншенов зависит от того включены они или нет)

![Teamcity](build-2.png)

Принудительный запуск фулл ребилда (ребилд экстеншенов зависит от того включены они или нет)

![Teamcity](build-3.png)
